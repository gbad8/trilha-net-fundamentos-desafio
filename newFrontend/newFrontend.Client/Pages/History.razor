@page "/history"
@using newFrontend.Client.Pages
@using Parking.Shared.Models
@using newFrontend.Client.Services
@inject IDialogService DialogService
@inject IParkingService ParkingService
@inject ISnackbar Snackbar

<PageTitle> Histórico - T&D</PageTitle>

<br />
<MudText Typo="Typo.h4" GutterBottom="true">Histórico</MudText>

<MudStack Row="true" AlignItems="AlignItems.Center">
  <MudText Typo="Typo.subtitle1">Nesta página, você pode verificar o histórico de veículos estacionados no T&D Parking.
    <br />Selecione os veículos que você deseja excluir e clique no botão "Excluir do Histórico" ao lado.
  </MudText>

  <MudSpacer />

  <MudButton Variant="Variant.Filled" StartIcon="@Icons.Material.Filled.Delete" Color="Color.Error" Size="Size.Medium"
    DropShadow="false" Disabled="@(selectedItems.Count == 0)" OnClick="@(()=> DeleteVehicles(selectedItems))">Excluir do
    Histórico</MudButton>

  <MudSpacer />

</MudStack>

<br />

<MudTable Items="@veiculos" FixedHeader="@fixed_header" FixedFooter="@fixed_footer"
  Height="@(fixed_header || fixed_footer ? "300px" : "")" Hover="true" Breakpoint="Breakpoint.Sm"
  Filter="@(veiculo => FilterFunc(veiculo, searchString1))" Loading="@loading" LoadingProgressColor="Color.Info"
  MultiSelection="true" @bind-SelectedItems="selectedItems">
  <ToolBarContent>
    <MudText Typo="Typo.h6">Histórico de Veículos Estacionados</MudText>
    <MudSpacer />
    <MudTextField @bind-Value="searchString1" Placeholder="Pesquisa por placa" Adornment="Adornment.Start"
      AdornmentIcon="@Icons.Material.Filled.Search" IconSize="Size.Medium" Class="mt-0"></MudTextField>
  </ToolBarContent>
  <HeaderContent>
    <MudTh>
      <MudTableSortLabel SortBy="@((Veiculo veiculo) => veiculo.Placa)">
        Placa
      </MudTableSortLabel>
    </MudTh>
    <MudTh>
      <MudTableSortLabel SortBy="@((Veiculo veiculo) => veiculo.Type)">
        Tipo
      </MudTableSortLabel>
    </MudTh>
    <MudTh>
      <MudTableSortLabel SortBy="@((Veiculo veiculo) => veiculo.EntryTime)">
        Entrada
      </MudTableSortLabel>
    </MudTh>
    <MudTh>Saída</MudTh>
    <MudTh>Valor Cobrado</MudTh>
  </HeaderContent>
  <RowTemplate>
    <MudTd DataLabel="Placa">
      <MudChip T="string" Label="true">@context.Placa</MudChip>
    </MudTd>
    <MudTd DataLabel="Tipo">@FormatType(context.Type)</MudTd>
    <MudTd DataLabel="Entrada">@context.EntryTime.ToString("g")</MudTd>
    <MudTd DataLabel="Saída">@context.DepartureTime?.ToString("g")</MudTd>
    <MudTd DataLabel="Valor">@context.TicketPrice?.ToString("C")</MudTd>
  </RowTemplate>
  <PagerContent>
    <MudTablePager />
  </PagerContent>
</MudTable>
