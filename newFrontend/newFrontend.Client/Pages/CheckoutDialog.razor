@using newFrontend.Client.Models
@using newFrontend.Client.Services
@inject IParkingService ParkingService
@inject HttpClient Http

<MudDialog>
  <DialogContent>
    @if (vehiclepreview == null)
    {
      <MudProgressCircular Indeterminate="true" />
      <MudText>Carregando informações ...</MudText>
    }
    else
    {
      <MudText Typo="Typo.subtitle1">Confira abaixo os dados do veículo antes de proceder com a confirmação do checkout.
      </MudText>
      <MudDivider Class="mb-3" />

      <MudGrid>
        <MudItem xs="7">
          <MudStack>
            <MudPaper Class="pa-3"><b>Placa:</b> @vehiclepreview.Placa</MudPaper>

            <MudPaper Class="pa-3">
              <b>Entrada:</b> @vehiclepreview.EntryTime.ToString("g")
            </MudPaper>

            <MudPaper Class="pa-3">
              <b>Saída:</b> @vehiclepreview.DepartureTime?.ToString("g")
            </MudPaper>
          </MudStack>
        </MudItem>
        <MudItem xs="5" Class="d-flex">
          <MudCard Class="h-100 w-100 d-flex flex-column justify-center">
            <MudCardHeader>
              <MudText Typo="Typo.h5" Align="Align.Center"><b>Total a pagar:</b></MudText>
            </MudCardHeader>
            <MudCardContent>
              <MudText Typo="Typo.h5" Align="Align.Center" Color="Color.Success">
                @vehiclepreview.TicketPrice?.ToString("C2")</MudText>
            </MudCardContent>
          </MudCard>
        </MudItem>
      </MudGrid>
    }
  </DialogContent>
  <DialogActions>
    <MudButton OnClick="Cancel">Cancelar</MudButton>
    <MudButton Color="Color.Success" Variant="Variant.Filled" Disabled="@(vehiclepreview == null)" OnClick="Confirm">
      Confirmar</MudButton>
  </DialogActions>
</MudDialog>

@code {
  [CascadingParameter] IMudDialogInstance? MudDialog { get; set; }

  [Parameter] public int VehicleId { get; set; }

  private Veiculo? vehiclepreview;

  protected override async Task OnInitializedAsync()
  {
    vehiclepreview = await ParkingService.CheckoutPreviewAsync(VehicleId);
  }

  private void Cancel() => MudDialog?.Cancel();

  private void Confirm()
  {
    if (vehiclepreview?.DepartureTime != null)
    {
      MudDialog?.Close(DialogResult.Ok(vehiclepreview.DepartureTime.Value));
    }
  }
}
